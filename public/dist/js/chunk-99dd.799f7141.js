(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-99dd"],{"0d03":function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}var o=n("a322"),r=(n("56d7"),n("c0d6")),c=n("90de"),l=function(e){var t=e.data;return Object(c["h"])(t)?JSON.parse(t):t},u=function(){function e(t,n){s(this,e),Object(o["a"])(this,"url",r["a"].state.common.websocketBaseUrl),Object(o["a"])(this,"_heart_beat_time",3e4),Object(o["a"])(this,"_interval_id",null),Object(o["a"])(this,"_ws",null),Object(o["a"])(this,"_event",null),this.event=t,this.ws=new WebSocket(this.url);var i=this;this.ws.onopen=function(e){clearInterval(i._interval_id),i._interval_id=setInterval(function(){i.send(i.event,"beep",1)},i._heart_beat_time),i.send(i.event,"register",n)},this.ws.onmessage=function(e){console.log("socket init",l(e))},this.ws.onclose=function(e){clearInterval(i._interval_id)}}return a(e,[{key:"ws",set:function(e){this._ws=e},get:function(){return this._ws}},{key:"event",set:function(e){this._event=e},get:function(){return this._event}},{key:"isOnline",get:function(){return!!this.ws}}]),a(e,[{key:"send",value:function(e,t,n){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this.isOnline)return!1;if(s){var i=this;return new Promise(function(s,a){i.ws.onmessage=function(e){s(l(e))},i.ws.send(JSON.stringify({event:e,key:t,value:n}))})}this.ws.send(JSON.stringify({event:e,key:t,value:n}))}},{key:"onmessage",value:function(e){this.ws.onmessage=function(t){e(l(t))}}},{key:"close",value:function(){clearInterval(this._interval_id),this.ws.close()}}]),e}(),d=u;t["a"]=d},a322:function(e,t,n){"use strict";function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",function(){return s})},f318:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticStyle:{"margin-bottom":"10px","margin-top":"10px","margin-left":"8px"}},[e.ws?n("a-tag",{attrs:{color:"#87d068"}},[e._v("在线")]):n("a-tag",{attrs:{color:"#f50"}},[e._v("离线")]),e.ws?[e._v("\n            "+e._s("在线 "+e.onlineUserIds.length+" 人 已选 "+e.selectedRowKeys.length+" 人")+"\n        ")]:e._e()],2),n("a-table",{attrs:{pagination:!1,rowKey:"id",size:"small",rowSelection:{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,dataSource:e.data}})],1)},i=[],a=(n("c5f6"),n("cadf"),n("551c"),n("097d"),n("0d03")),o=n("c24f"),r=(n("66df"),n("c0d6"),{props:{id:{required:!1,type:Number,default:function(){return 0}}},data:function(){return{form:{},data:[],columns:[{title:"名字",dataIndex:"name",key:"name"},{title:"账户类型",dataIndex:"type_format",key:"type_format"},{title:"角色",dataIndex:"roles_format",key:"roles_format"},{title:"电话",dataIndex:"cellphone",key:"cellphone"},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},buttons:{check:{visible:!0,disable:!1},edit:{visible:!0,disable:!1,title:"发送消息"}}}],selectedRowKeys:[],onlineUserIds:[],loading:!1,ws:null}},computed:{hasSelected:function(){return this.selectedRowKeys.length>0}},methods:{init:function(){var e=this;this.ws&&this.ws.close(),this.ws=new a["a"],this.ws.init(this.$store.state.common.user_id),this.ws.onmessage(function(t){switch(t.key){case"push_uids":e.onlineUserIds=t.value,e.fetch();break;case"get_uids":e.onlineUserIds=t.value,e.fetch();break}})},fetch:function(){var e=this;Object(o["i"])({current_page:0,filter:{ids:this.onlineUserIds}}).then(function(t){e.data=t.data.rows})},onSelectChange:function(e){this.selectedRowKeys=e}},beforeRouteLeave:function(e,t,n){this.ws.close(),n()},mounted:function(){this.init()}}),c=r,l=n("2877"),u=Object(l["a"])(c,s,i,!1,null,null,null);u.options.__file="Index.vue";t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-99dd.799f7141.js.map