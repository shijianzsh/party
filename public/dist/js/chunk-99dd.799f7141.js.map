{"version":3,"sources":["webpack:///./node_modules/@babel/runtime/helpers/builtin/es6/classCallCheck.js","webpack:///./node_modules/@babel/runtime/helpers/builtin/es6/createClass.js","webpack:///./src/socket/helper.js","webpack:///./src/socket/socket.js","webpack:///./src/socket/index.js","webpack:///./node_modules/@babel/runtime/helpers/builtin/es6/defineProperty.js","webpack:///./src/views/super/在线人员管理/Index.vue?134c","webpack:///src/views/super/在线人员管理/Index.vue","webpack:///./src/views/super/在线人员管理/Index.vue?6e25","webpack:///./src/views/super/在线人员管理/Index.vue"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","helper_analyzeResponse","res","data","tools","JSON","parse","socket_socket","socket","event","uid","this","store","state","common","websocketBaseUrl","ws","WebSocket","url","_self","onopen","evt","clearInterval","_interval_id","setInterval","send","_heart_beat_time","onmessage","console","log","onclose","val","_ws","_event","requestKey","requestValue","usePromise","arguments","undefined","isOnline","Promise","resolve","reject","stringify","value","func","close","src_socket_socket","__webpack_exports__","_defineProperty","obj","render","_vm","_h","$createElement","_c","staticStyle","margin-bottom","margin-top","margin-left","attrs","color","_v","_s","onlineUserIds","selectedRowKeys","_e","pagination","rowKey","size","rowSelection","onChange","onSelectChange","columns","dataSource","staticRenderFns","Indexvue_type_script_lang_js_","id","required","type","Number","default","form","title","dataIndex","scopedSlots","customRender","buttons","check","visible","disable","edit","loading","computed","hasSelected","methods","init","_this","$store","user_id","fetch","_this2","user","current_page","filter","ids","then","rows","beforeRouteLeave","to","from","next","mounted","_Indexvue_type_script_lang_js_","component","componentNormalizer","options","__file"],"mappings":"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","file":"js/chunk-99dd.799f7141.js","sourcesContent":["export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import Vue from '@/main.js'\nimport store from '@/store'\nimport {is_json} from \"@/libs/tools\";\n\nexport const analyzeResponse = (res) => {\n    let data = res.data;\n    return is_json(data) ? JSON.parse(data) : data;\n};\n\nexport const notification = (res) => {\n    //TODO 判断res返回值success\n    console.log('notification', res);\n\n    switch (res.key) {\n        case 'set_uid':\n            Vue.$notification.success({\n                duration: 1,\n                message: '推送服务连接成功',\n            });\n            break;\n        case 'push_notification_to_uid':\n            store.state.pc.pushSignal++;\n            const key = `open${Date.now()}`;\n            Vue.$notification.info({\n                key,\n                duration: null,\n                message: '新的通知',\n                btn: (h) => {\n                    return h('a-button', {\n                        props: {\n                            type: 'primary',\n                            size: 'small',\n                        },\n                        on: {\n                            click: () => {\n                                Vue.$router.push({name: '通知列表', params: {type: 0}});\n                                Vue.$notification.close(key);\n                            }\n                        }\n                    }, '去查看')\n                },\n            });\n            break;\n        case 'push_to_uid':\n            Vue.$notification.info({\n                duration: null,\n                message: '新的通知',\n            });\n            break;\n        case 'push_to_all':\n            Vue.$notification.info({\n                duration: null,\n                message: '新的通知',\n            });\n            break;\n        case 'push_to_admin':\n            Vue.$notification.warning({\n                duration: null,\n                message: '新的通知',\n            });\n            break;\n        default:\n            console.log(res);\n            break;\n    }\n}\n\nexport const chat = (res) => {\n    //TODO 判断res返回值success\n    console.log('chat', res);\n\n    switch (res.key) {\n        case 'get_uids'://接收新消息\n            store.state.chat.online_users = res.value;\n            break;\n        case 'chat_to_user_new_message'://接收新消息\n\n            break;\n        case 'chat_to_user'://发送消息回执\n\n            break;\n    }\n}\n\n","import Vue from '@/main.js'\nimport store from '@/store'\nimport {analyzeResponse, notification, chat} from './helper'\n\nclass socket {\n    url = store.state.common.websocketBaseUrl;\n    _heart_beat_time = 30000;\n    _interval_id = null;\n    _ws = null;\n    _event = null;\n\n    set ws(val) {\n        this._ws = val;\n    }\n\n    get ws() {\n        return this._ws;\n    }\n\n    set event(val) {\n        this._event = val;\n    }\n\n    get event() {\n        return this._event;\n    }\n\n    get isOnline() {\n        return !!this.ws;\n    }\n\n    constructor(event, uid) {\n        this.event = event;\n        this.ws = new WebSocket(this.url);\n\n        let _self = this;\n\n        this.ws.onopen = function (evt) {\n            //心跳\n            clearInterval(_self._interval_id);\n\n            _self._interval_id = setInterval(() => {\n                _self.send(_self.event, 'beep', 1);\n            }, _self._heart_beat_time);\n\n            _self.send(_self.event, 'register',uid);\n        };\n\n        this.ws.onmessage = (res) => {\n            console.log('socket init', analyzeResponse(res));\n        };\n\n        this.ws.onclose = function (evt) {\n            clearInterval(_self._interval_id);\n        };\n    }\n\n    send(event, requestKey, requestValue, usePromise = false) {\n        if (!this.isOnline) {\n            return false;\n        }\n\n        if (usePromise) {\n            let _self = this;\n            return new Promise(function (resolve, reject) {\n                _self.ws.onmessage = (res) => {\n                    resolve(analyzeResponse(res));\n                };\n                _self.ws.send(JSON.stringify({event, key: requestKey, value: requestValue}));\n            });\n        } else {\n            this.ws.send(JSON.stringify({event, key: requestKey, value: requestValue}));\n        }\n    }\n\n    onmessage(func){\n        this.ws.onmessage = (res) => {\n            func(analyzeResponse(res));\n        };\n    }\n\n    close(){\n        clearInterval(this._interval_id);\n        this.ws.close();\n    }\n}\n\nexport default socket;\n","import main from './socket'\nexport default main\n","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticStyle:{\"margin-bottom\":\"10px\",\"margin-top\":\"10px\",\"margin-left\":\"8px\"}},[(_vm.ws)?_c('a-tag',{attrs:{\"color\":\"#87d068\"}},[_vm._v(\"在线\")]):_c('a-tag',{attrs:{\"color\":\"#f50\"}},[_vm._v(\"离线\")]),(_vm.ws)?[_vm._v(\"\\n            \"+_vm._s((\"在线 \" + (_vm.onlineUserIds.length) + \" 人 已选 \" + (_vm.selectedRowKeys.length) + \" 人\"))+\"\\n        \")]:_vm._e()],2),_c('a-table',{attrs:{\"pagination\":false,\"rowKey\":\"id\",\"size\":\"small\",\"rowSelection\":{selectedRowKeys: _vm.selectedRowKeys, onChange: _vm.onSelectChange},\"columns\":_vm.columns,\"dataSource\":_vm.data}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div>\n        <div style=\"margin-bottom: 10px;margin-top: 10px;margin-left: 8px\">\n            <a-tag color=\"#87d068\" v-if=\"ws\">在线</a-tag>\n            <a-tag color=\"#f50\" v-else>离线</a-tag>\n            <template v-if=\"ws\">\n                {{`在线 ${onlineUserIds.length} 人 已选 ${selectedRowKeys.length} 人`}}\n            </template>\n        </div>\n        <a-table :pagination=\"false\"\n                 rowKey=\"id\"\n                 size=\"small\"\n                 :rowSelection=\"{selectedRowKeys: selectedRowKeys, onChange: onSelectChange}\"\n                 :columns=\"columns\"\n                 :dataSource=\"data\"/>\n    </div>\n</template>\n\n<script>\n    import ws from '@/socket'\n    import {getUserList, deleteUser} from '@/api/user'\n    import {pushSocket, pushSms} from '@/api/pusher'\n\n    export default {\n        props: {\n            id: {\n                required: false,\n                type: Number,\n                default() {\n                    return 0;\n                }\n            }\n        },\n        data() {\n            return {\n                form: {},\n                data: [],\n                columns: [\n                    {\n                        title: '名字',\n                        dataIndex: 'name',\n                        key: 'name',\n                    },\n                    {\n                        title: '账户类型',\n                        dataIndex: 'type_format',\n                        key: 'type_format',\n                    },\n                    {\n                        title: '角色',\n                        dataIndex: 'roles_format',\n                        key: 'roles_format',\n                    },\n                    {\n                        title: '电话',\n                        dataIndex: 'cellphone',\n                        key: 'cellphone',\n                    },\n                    {\n                        title: '操作',\n                        dataIndex: 'operation',\n                        scopedSlots: {customRender: 'operation'},\n                        buttons: {\n                            check: {visible: true, disable: false,},\n                            edit: {visible: true, disable: false, title: '发送消息'},\n                        }\n                    }\n                ],\n                selectedRowKeys: [], // Check here to configure the default column\n                onlineUserIds: [],\n                loading: false,\n                ws: null,\n            }\n        },\n        computed: {\n            hasSelected() {\n                return this.selectedRowKeys.length > 0\n            }\n        },\n        methods: {\n            init() {\n                if (this.ws) {\n                    this.ws.close();\n                }\n                this.ws = new ws();\n                this.ws.init(this.$store.state.common.user_id);\n                this.ws.onmessage(res => {\n                    switch (res.key) {\n                        case 'push_uids':\n                            this.onlineUserIds = res.value;\n                            this.fetch();\n                            break;\n                        case 'get_uids':\n                            this.onlineUserIds = res.value;\n                            this.fetch();\n                            break;\n                    }\n                });\n            },\n            fetch() {\n                getUserList({current_page: 0, filter: {ids: this.onlineUserIds}})\n                    .then(res => {\n                        this.data = res.data.rows\n                    });\n            },\n            onSelectChange(selectedRowKeys) {\n                this.selectedRowKeys = selectedRowKeys\n            }\n        },\n        beforeRouteLeave(to, from, next) {\n            this.ws.close();\n            next();\n        },\n        mounted() {\n            this.init();\n        }\n    }\n</script>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Index.vue?vue&type=template&id=2506a504&\"\nimport script from \"./Index.vue?vue&type=script&lang=js&\"\nexport * from \"./Index.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"Index.vue\"\nexport default component.exports"],"sourceRoot":""}